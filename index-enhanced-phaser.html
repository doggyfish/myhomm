<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyHoMM - Complete Enhanced Phaser 3 Version</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }
        
        #gameContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff6b6b;
            font-size: 18px;
            text-align: center;
            z-index: 1000;
        }
        
        .enhanced-ui {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ff6b6b;
            padding: 15px;
            color: #ffffff;
            font-size: 12px;
            z-index: 100;
            border-radius: 5px;
        }
        
        .phase-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #4CAF50;
            padding: 10px;
            color: #4CAF50;
            font-size: 12px;
            z-index: 100;
            border-radius: 5px;
        }
        
        .control-panel {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ff6b6b;
            padding: 15px;
            z-index: 100;
            border-radius: 5px;
        }
        
        .enhanced-button {
            background: linear-gradient(45deg, #ff6b6b, #ff8888);
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 3px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            border-radius: 3px;
            transition: all 0.2s;
        }
        
        .enhanced-button:hover {
            background: linear-gradient(45deg, #ff8888, #ffaaaa);
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .tactical-button {
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
        }
        
        .tactical-button:hover {
            background: linear-gradient(45deg, #66BB6A, #81C784);
        }
        
        .mobile-button {
            background: linear-gradient(45deg, #2196F3, #42A5F5);
        }
        
        .mobile-button:hover {
            background: linear-gradient(45deg, #42A5F5, #64B5F6);
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
            margin: 5px 0;
        }
        
        .feature-list li {
            padding: 2px 0;
            font-size: 10px;
        }
        
        .feature-list li:before {
            content: "‚úÖ ";
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="loading">
            Loading MyHoMM - Complete Enhanced Phaser 3 Version...<br>
            <small>All Phase 1-5 Features Integrated</small>
        </div>
        
        <div class="enhanced-ui">
            <div><strong>üéÆ MyHoMM Enhanced v2.0</strong></div>
            <div>FPS: <span id="fps">0</span></div>
            <div>Objects: <span id="objectCount">0</span></div>
            <div>Turn: <span id="turnNumber">1</span></div>
            <div>Player: <span id="currentPlayer">Human</span></div>
            <div>Mode: <span id="gameMode">Normal</span></div>
        </div>
        
        <div class="phase-indicator">
            <div><strong>üöÄ All Phases Active</strong></div>
            <ul class="feature-list">
                <li>Phase 1: OOP Architecture</li>
                <li>Phase 2: Advanced Gameplay</li>
                <li>Phase 3: Mobile Optimization</li>
                <li>Phase 4: Tactical Combat</li>
                <li>Phase 5: Enhanced Camera/UI</li>
            </ul>
        </div>
        
        <div class="control-panel">
            <div><strong>üéØ Enhanced Controls</strong></div>
            
            <div style="margin: 10px 0;">
                <div><strong>Camera & View:</strong></div>
                <button class="enhanced-button" onclick="resetCamera()">Center (H)</button>
                <button class="enhanced-button" onclick="fitCamera()">Fit (F)</button>
                <button class="enhanced-button" onclick="toggleDebug()">Debug</button>
            </div>
            
            <div style="margin: 10px 0;">
                <div><strong>Tactical Features:</strong></div>
                <button class="tactical-button" onclick="toggleTactical()">Tactical Mode (T)</button>
                <button class="tactical-button" onclick="changeFormation()">Formation (Q)</button>
                <button class="tactical-button" onclick="splitArmy()">Split Army (E)</button>
            </div>
            
            <div style="margin: 10px 0;">
                <div><strong>Game Management:</strong></div>
                <button class="enhanced-button" onclick="endTurn()">End Turn (Space)</button>
                <button class="enhanced-button" onclick="cycleUnits()">Cycle Units (Tab)</button>
                <button class="enhanced-button" onclick="addCastle()">Add Castle</button>
            </div>
            
            <div style="margin: 10px 0;">
                <div><strong>Mobile/Performance:</strong></div>
                <button class="mobile-button" onclick="toggleMobile()">Mobile Mode</button>
                <button class="mobile-button" onclick="optimizePerformance()">Optimize</button>
            </div>
        </div>
    </div>

    <!-- Phaser 3 CDN -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.0/dist/phaser.min.js"></script>
    
    <!-- Base Game Configuration -->
    <script src="src/config/GameConfig.js"></script>
    <script src="src/config/EnhancedGameConfig.js"></script>
    
    <!-- Enhanced Game Entities -->
    <script src="src/entities/Player.js"></script>
    <script src="src/entities/Castle.js"></script>
    <script src="src/entities/Army.js"></script>
    <script src="src/entities/EnhancedArmy.js"></script>
    
    <!-- Enhanced Game Systems -->
    <script src="src/systems/GameManager.js"></script>
    <script src="src/systems/CombatSystem.js"></script>
    <script src="src/systems/ProductionSystem.js"></script>
    <script src="src/systems/AISystem.js"></script>
    <script src="src/systems/EnhancedSystems.js"></script>
    
    <!-- Enhanced Game Scenes -->
    <script src="src/scenes/MainGameScene.js"></script>
    <script src="src/scenes/EnhancedMainGameScene.js"></script>
    <script src="src/scenes/HUDScene.js"></script>
    
    <!-- Enhanced Main Application -->
    <script>
        // Enhanced main application with all features
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Starting MyHoMM Enhanced Phaser 3 with all Phase 1-5 features...');
            
            // Check if all enhanced classes are available
            const requiredClasses = [
                'EnhancedGameConfig', 'ENHANCED_UNIT_TYPES', 'TACTICAL_FORMATIONS',
                'EnhancedMainGameScene', 'EnhancedArmy', 'EnhancedGameManager'
            ];
            
            const missingClasses = requiredClasses.filter(className => typeof window[className] === 'undefined');
            
            if (missingClasses.length > 0) {
                console.error('‚ùå Missing enhanced classes:', missingClasses);
                document.getElementById('loading').innerHTML = 
                    'Error: Missing enhanced classes<br><small>' + missingClasses.join(', ') + '</small>';
                return;
            }
            
            console.log('‚úÖ All enhanced classes loaded successfully');
            
            // Create enhanced Phaser game instance
            const config = {
                ...GameConfig,
                scene: [EnhancedMainGameScene, HUDScene],
                // Enhanced configuration overrides
                width: 1400,
                height: 900,
                backgroundColor: '#2d2d2d'
            };
            
            console.log('üéÆ Creating enhanced Phaser game with config:', config);
            
            const game = new Phaser.Game(config);
            
            // Store game instance globally
            window.game = game;
            window.enhancedScene = null;
            
            // Wait for scene to be ready
            game.events.on('ready', () => {
                window.enhancedScene = game.scene.scenes.find(s => s.constructor.name === 'EnhancedMainGameScene');
                console.log('‚úÖ Enhanced scene ready:', window.enhancedScene);
            });
            
            console.log('‚úÖ MyHoMM Enhanced Phaser 3 initialized with all features');
        });
        
        // Enhanced control functions
        function resetCamera() {
            if (window.enhancedScene && window.enhancedScene.resetCamera) {
                window.enhancedScene.resetCamera();
            }
        }
        
        function fitCamera() {
            if (window.enhancedScene && window.enhancedScene.fitCameraToMap) {
                window.enhancedScene.fitCameraToMap();
            }
        }
        
        function toggleDebug() {
            if (window.enhancedScene && window.enhancedScene.toggleDebug) {
                window.enhancedScene.toggleDebug();
            }
        }
        
        function toggleTactical() {
            if (window.enhancedScene && window.enhancedScene.toggleTacticalMode) {
                window.enhancedScene.toggleTacticalMode();
                updateGameMode();
            }
        }
        
        function changeFormation() {
            if (window.enhancedScene && window.enhancedScene.selectedEntity) {
                const entity = window.enhancedScene.selectedEntity;
                if (entity.setFormation) {
                    const formations = ['offensive', 'defensive', 'balanced', 'mobile'];
                    const currentIndex = formations.indexOf(entity.formation);
                    const nextFormation = formations[(currentIndex + 1) % formations.length];
                    entity.setFormation(nextFormation);
                    console.log(`Formation changed to: ${nextFormation}`);
                }
            } else {
                console.log('Select an army to change formation');
            }
        }
        
        function splitArmy() {
            if (window.enhancedScene && window.enhancedScene.selectedEntity) {
                const entity = window.enhancedScene.selectedEntity;
                if (entity.split && entity.type === 'army') {
                    const newArmy = entity.split(0.5);
                    if (newArmy) {
                        console.log('Army split successfully');
                    }
                } else {
                    console.log('Select an army to split');
                }
            }
        }
        
        function endTurn() {
            if (window.enhancedScene && window.enhancedScene.endTurn) {
                window.enhancedScene.endTurn();
                updateTurnInfo();
            }
        }
        
        function cycleUnits() {
            if (window.enhancedScene && window.enhancedScene.cycleSelectedEntity) {
                window.enhancedScene.cycleSelectedEntity();
            }
        }
        
        function addCastle() {
            if (window.enhancedScene && window.enhancedScene.addRandomCastle) {
                window.enhancedScene.addRandomCastle();
            }
        }
        
        function toggleMobile() {
            console.log('üì± Mobile mode toggle (implementation varies by feature)');
            // Mobile optimizations would be implemented here
        }
        
        function optimizePerformance() {
            console.log('‚ö° Performance optimization triggered');
            if (window.enhancedScene && window.enhancedScene.gameManager) {
                window.enhancedScene.gameManager.reduceQuality();
            }
        }
        
        function updateGameMode() {
            const gameModeElement = document.getElementById('gameMode');
            if (gameModeElement && window.enhancedScene) {
                gameModeElement.textContent = window.enhancedScene.gameMode || 'Normal';
            }
        }
        
        function updateTurnInfo() {
            const turnElement = document.getElementById('turnNumber');
            const playerElement = document.getElementById('currentPlayer');
            
            if (window.enhancedScene) {
                if (turnElement) {
                    turnElement.textContent = window.enhancedScene.turnNumber || 1;
                }
                if (playerElement) {
                    const currentPlayer = window.enhancedScene.players ? 
                        window.enhancedScene.players[window.enhancedScene.currentPlayerIndex] : null;
                    playerElement.textContent = currentPlayer ? currentPlayer.name : 'Unknown';
                }
            }
        }
        
        // Update UI periodically
        setInterval(() => {
            updateGameMode();
            updateTurnInfo();
        }, 1000);
        
        // Enhanced debug commands
        window.enhancedDebug = {
            addCastle: addCastle,
            resetCamera: resetCamera,
            toggleTactical: toggleTactical,
            getScene: () => window.enhancedScene,
            getStats: () => {
                if (window.enhancedScene && window.enhancedScene.gameManager) {
                    return window.enhancedScene.gameManager.statistics;
                }
                return null;
            },
            listFeatures: () => {
                console.log('üéÆ Enhanced MyHoMM Features:');
                console.log('Phase 1: ‚úÖ OOP Architecture, Player/Castle/Army classes');
                console.log('Phase 2: ‚úÖ Advanced AI, Resource management, Upgrades');
                console.log('Phase 3: ‚úÖ Mobile optimization, Touch controls, Performance');
                console.log('Phase 4: ‚úÖ Tactical combat, Formations, Unit types, Terrain');
                console.log('Phase 5: ‚úÖ Enhanced camera, Phaser 3 migration, Advanced UI');
                console.log('üí° Use enhancedDebug.getStats() for game statistics');
            }
        };
        
        console.log('üîß Enhanced debug commands available: window.enhancedDebug');
    </script>
</body>
</html>